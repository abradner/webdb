=render :partial => 'shared/modal_form', :locals => {:obj => @import_mapping, :modal_title => ("Preview This Import Mapping (" + @import_mapping.name + ")")}
.field.line
  %label Settings
  .lastUnit
    - if @raw_files
      = form_for @import_mapping, :url => preview_system_data_object_import_mapping_path(@system, @data_object, @import_mapping),:method => :post, :remote => true do |f|
        = label_tag(:raw_file, "File To Preview")
        -#= select_tag(:raw_file_id, @raw_files.collect{ |rf | [ rf.stored_file_identifier, rf.id]})
        = select_tag(:raw_file, options_for_select(@raw_files))
        %div
          = label_tag(:delimiter, "Delimiter")
          = select_tag(:delimiter, options_for_select(@delimiters))
        %div
          = label_tag(:header, "First Row Contains Field Names?")
          = check_box_tag(:header, 1, true)
        %div
          = f.submit "Preview File"
    - else
      No files were detected in the system.
- if @raw_file
  .field.line
    %label
      = "File Preview : #{@raw_file} with #{@delimiter} as delimiter"
    = render :partial => "file_preview", :locals => {:csv => @csv}

  #attr_list
    - @data_object_attributes.each do |attr|
      %p.attribute_label.draggable{"data-id" => attr.id } #{attr.name}
- else
  .field.line
    %label
      = "File Preview : None selected"

  .lastUnit

#bottom_actions_container
  .field.line
    .field.actions
      = button_link_to "Back", system_data_object_import_mappings_path(@system, @data_object), :remote => true

:javascript
  jQuery(function() {
    $('.draggable').draggable({
        revert:true,
        helper:'clone',
        opacity: 0.5
    });

    $('.column').droppable({
        activeClass: 'dropActive',
        accept: function(d) {

          if ($(this).html() == "") {
            $(this).html("unassigned");
          }
          if($(this).html() == "unassigned" ){
            return true;
          }
        },

        drop: function(event,ui){

          event.stopPropagation();
          ui.helper.hide();
          var $drag = $(ui.draggable),
              $drop = $(this),
              $data = {};

          $(this).html($drag);
          
          $('p', this).removeClass('draggable');
          $('p', this).removeClass('ui-draggable');
          $(this).css('backgroundColor', "#BBBBBB");
          $(this).css('color', "black");

        },
        over: function(event, ui) {
          var bg_color = $(this).css('backgroundColor');
          var color = $(this).css('color');
          $(this).css('backgroundColor', "black");
          $(this).css('color', "#BBBBBB");
        },
        out: function(event, ui) {
          var bg_color = $(this).css('backgroundColor');
          var color = $(this).css('color');
          $(this).css('backgroundColor', "#BBBBBB");
          $(this).css('color', "black");
        }
    });

  });

